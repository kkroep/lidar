\subsubsection{Resolution} 
\label{sssec:resolution}

The maximum allowable $FWHM$ of the measurement is $333\,ps$ as shown in \cref{ssec:assumptions}. Using \cref{eq:FWHM_sigma} the maximum standard deviation is $\sigma=141\,ps$.

\begin{align}\label{eq:sigma_FWHM}
	FWHM   &= 2\sqrt{2\ln2}\sigma \\
	\sigma &= \frac{FWHM}{2\sqrt{2\ln2}}\label{eq:FWHM_sigma}
\end{align}

In this section this requirement is calculated backwards towards requirements of system components. The last stage of a measurement is the TDC, but it is assumed that the jitter of the TDC will be insignificant. The next part is the SPAD, for which is assumed a jitter of $100\,ps$. One can use \cref{eq:sigma_in} to calculate the maximum allowable standard deviation of the signal that enters the SPAD. This calculation is done in \cref{tab:sigma_SPAD}

\begin{align}\label{eq:sigma_out}
	\sigma_{out} &= \sqrt{\sigma_{in}^2+\sigma^2}\\
	\sigma_{in}  &= \sqrt{\sigma_{out}^2-\sigma^2} \label{eq:sigma_in}
\end{align}
where $\sigma_{out}$ is the maximum allowable standard deviation at the output, $\sigma$ the standard deviation of the SPAD, and $\sigma_{in}$ the maximum allowable standard deviation at the input.
\input{tab/sigma_SPAD_tab}

The standard deviation of the signal entering the SPADs is determined by the characteristics of the background noise, and signal power. The power of the background noise leaving the surface of interest at europa is calculated in \cref{ssec:background_noise}, and is $P_B = 0.179\,W$. However, this is the power at Europa. One can use \cref{eq:europa_SPAD} to calculate the amount of power that hits the SPADs.

\begin{align}
	P_B' &= \frac{P_B}{4\pi r^2}\cdot R_{europa}L_fL_l
\end{align}
where $P_B'$ is the background noise at the SPADs, $r$ the altitude of the sensor, $R_{europa}$ the reflectivity of Europa, $L_f$ the opacity of the bandpass filter, and $L_l$ the effective opacity of the optics. This calculation is performed in \cref{tab:effective_noise_power} 

\input{tab/effective_noise_power_tab}

The next step is to calculate the number of background noise photons per second ($PPS_B$) that are detected by the SPAD. For that, one first needs to know the energy of a single photon $E_{photon}$. To calculate $E_{photon}$ one can use \cref{eq:energy_photon}. The calculation of this is shown in \cref{tab:energy_photon}.

\begin{align}\label{eq:energy_photon}
	E_{photon} &= \frac{hc}{\lambda}
\end{align}

\input{tab/energy_photon_tab}

Now to calculate the $PPS_B$ one can use \cref{eq:PPS_B}

\begin{align}\label{eq:PPS_B}
	PPS_B &= \frac{P_B'}{E_{photon}}\cdot PDP
\end{align}
where $PDP$ is the photon detection probability of the SPADs. This calculation is done in \cref{tab:PPS_B}

\input{tab/PPS_B_tab}

The next step is to distribute the number of of background Photons Per Timeslot ($PPT_B$) that are formed by the TDC. This can be done using 

\begin{align}\label{eq:PPT_B}
	PPT &= PPS\cdot t_{TDC}
\end{align}
where $t_{TDC}$ is the accuracy of the TDC. This calculation is done in \cref{tab:PPT_B}

\input{tab/PPT_B_tab}

These powers can be used to define the noise as additive white gaussian noise (AWGN) with $\mu = 0$ and $\sigma = PPT_B$. \\
\\
The next step is to calculate the desired probability that a detected photon is a signal photon $p(s)$. 

\begin{align}
	\sigma_{total}^2 &= \int_{-50p}^{50\mu - 50p}[(1-p(s))f_b(t)+p(s)f_s(x)]t^2\,dt \\
	            &= \int_{-50p}^{50p}[\frac{1-p(s)}{50\mu}+\frac{p(s)}{100p}]t^2\,dt + \int_{50p}^{50 \mu-50p}\frac{1-p(s)}{50\mu}t^2\,dt\\
	            &\approx  \frac{p(s)}{3}(50p)^2 + \frac{1-p(s)}{3}(50\mu)^2
\end{align}
where $p(s)$ is the probability of a detected photon being a signal photon. 

\begin{align}
	\sigma_{total} &= \frac{p(s)}{3}(50p)^2 + \frac{1-p(s)}{3}(50\mu)^2 \\
	3\sigma_{total} &= p(s)((50p)^2-(50\mu)^2)+(50\mu)^2\\
	p(s) &= \frac{3\sigma_{total}^2-(50\mu)^2}{(50p)^2-(50\mu)^2}\\
	p(s) &\approx 1- \frac{3\sigma_{total}^2}{(50\mu)^2} \label{eq:p_s}
\end{align}

Now $p(s)$ can be calculated using \cref{eq:p_s}. $\sigma_{total} = 317.6p$, therefore $p(s)=1-1.2104\cdot10^{-10}$.\\
\\
The next step is to apply energy detection to the noise and signal. The threshold $\gamma$ is the amount of photons that are count in a timeslot, and because of that, the threshold is restricted to $\gamma \in \mathbb{N}$. To start off the required signal power is calculated for $\gamma=1$. First the probability of detection for noise is calculated  using \cref{eq:Q_function}. The calculation is performed in \cref{tab:p_b}.

\begin{align}\label{eq:Q_function}
	p(b) &=\mathcal{Q}(\frac{\gamma}{\sigma})
\end{align}

\input{tab/p_b_tab}